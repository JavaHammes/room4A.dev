<!DOCTYPE html>
<html lang="en-us"
  dir="ltr">

<head><script src="/room4A.dev/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=room4A.dev/livereload" data-no-instant defer></script>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width">








    






<link rel="icon" type="image/ico" href="http://localhost:1313/room4A.dev/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/room4A.dev/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/room4A.dev/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="192x192" href="http://localhost:1313/room4A.dev/android-chrome-192x192.png">
<link rel="apple-touch-icon" sizes="180x180" href="http://localhost:1313/room4A.dev/apple-touch-icon.png">

<meta name="description" content=""/>



<title>
    
    syscall(welcome_to_room4A); | room4A
    
</title>

<link rel="canonical" href="http://localhost:1313/room4A.dev/posts/syscall_hello_world/"/>

<meta property="og:url" content="http://localhost:1313/room4A.dev/posts/syscall_hello_world/">
  <meta property="og:site_name" content="room4A">
  <meta property="og:title" content="syscall(welcome_to_room4A);">
  <meta property="og:description" content="Welcome to my first blog post. Ever. # I thought about starting with the usual boring stuff, why I’m doing this blog, what you can expect, all that meta fluff.
But I won’t.
Instead, this post jumps straight into something more exciting:
A tutorial on writing your very own syscall, one that prints:
“Knock knock, room4A. Knock knock, room4A. Knock knock, room4A.”
(If you don’t know what a syscall is — well, Google it.)">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-07-22T10:18:48+02:00">
    <meta property="article:modified_time" content="2025-07-22T10:18:48+02:00">







<link rel="stylesheet" href="/room4A.dev/assets/combined.min.57df9e7d692553f966cff4593ede6b53efb74da234876bacffeac774bd572e53.css" media="all">











    




</head>





<body class="auto">

  <div class="content">
    <header>
      

<div class="header">

    

    <h1 class="header-title">
        <a href="http://localhost:1313/room4A.dev/">room4A</a>
    </h1>

    <div class="header-menu">
        

        
        

        <p
            class="small ">
            <a href="/" >
                /home
            </a>
        </p>
        

        <p
            class="small ">
            <a href="/posts" >
                /posts
            </a>
        </p>
        
        
    </div>

    

</div>

    </header>

    <main class="main">
      
  <h1>syscall(welcome_to_room4A);</h1>
  <p>July 22, 2025</p>
<h2 class="heading" id="welcome-to-my-first-blog-post-ever">
  Welcome to my first blog post. <strong>Ever.</strong>
  <a class="anchor" href="#welcome-to-my-first-blog-post-ever">#</a>
</h2>
<p>I thought about starting with the usual boring stuff, why I’m doing this blog, what you can expect, all that meta fluff.</p>
<p>But I won’t.</p>
<p>Instead, this post jumps straight into something more exciting:</p>
<p>A <strong>tutorial on writing your very own syscall</strong>, one that prints:</p>
<blockquote>
<p>&ldquo;Knock knock, room4A. Knock knock, room4A. Knock knock, room4A.&rdquo;</p>
</blockquote>
<p>(If you don’t know what a syscall is — well, <a href="https://www.google.com/search?q=what+is+a+syscall">Google it</a>.)</p>
<p>It’s a fun little exercise that’ll introduce you to how I write, how I code, and what kind of posts you can expect in the future.</p>
<hr>
<h3 class="heading" id="got-questions-or-feedback">
  Got questions or feedback?
  <a class="anchor" href="#got-questions-or-feedback">#</a>
</h3>
<p>If you get stuck or want to reach out, feel free to open an issue or start a discussion over at the <a href="https://github.com/yourrepo">GitHub repo for this blog</a>. Always happy to help.</p>
<hr>
<h2 class="heading" id="dependencies">
  Dependencies
  <a class="anchor" href="#dependencies">#</a>
</h2>
<p>Before we can start developing, we need to install a <em>few</em> dependencies.</p>
<p>On Fedora, you can install everything you need with the following dnf commands:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo dnf install -y build-essential libncurses-dev bison flex libssl-dev libelf-dev libelf1 bc cpio ncurses-devel bison flex openssl-devel elfutils-libelf-devel bc git cpio qemu-system-x86 nasm
</span></span></code></pre></div><p>These cover:</p>
<ul>
<li>Kernel build tools and headers (<code>build-essential</code>, <code>bc</code>, <code>libelf-dev</code>, etc.)</li>
<li>Development libraries (<code>libssl-dev</code>, <code>ncurses-devel</code>, <code>elfutils-libelf-devel</code>)</li>
<li>Assembler and emulator (<code>nasm</code>, <code>qemu-system-x86</code>)</li>
<li>Packaging tools (<code>cpio</code>)</li>
</ul>
<h2 class="heading" id="download-kernel-source">
  Download Kernel Source
  <a class="anchor" href="#download-kernel-source">#</a>
</h2>
<p>Before we can implement anything in the kernel, we need to get our hands on the actual source code.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>git clone https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git ksrc
</span></span><span style="display:flex;"><span>cd ksrc
</span></span></code></pre></div><p>Optional: To follow along exactly as shown, you can check out the specific kernel version used in this post:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>git checkout v6.16-rc7
</span></span></code></pre></div><p>This will download the kernel source into a directory named <code>ksrc</code>.</p>
<h2 class="heading" id="implementation">
  Implementation
  <a class="anchor" href="#implementation">#</a>
</h2>
<p>We’re going to add a new syscall numbered <strong>468</strong> called <code>room4A</code> that simply logs &ldquo;Knock knock, room4A. Knock knock, room4A. Knock knock, room4A.&rdquo; via <code>printk()</code>.</p>
<h3 class="heading" id="1-register-the-syscall-number">
  1. Register the syscall number
  <a class="anchor" href="#1-register-the-syscall-number">#</a>
</h3>
<p>Edit the syscall table at <code>arch/x86/entry/syscalls/syscall_64.tbl</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-diff" data-lang="diff"><span style="display:flex;"><span><span style="color:#f92672">--- a/arch/x86/entry/syscalls/syscall_64.tbl
</span></span></span><span style="display:flex;"><span><span style="color:#f92672"></span><span style="color:#a6e22e">+++ b/arch/x86/entry/syscalls/syscall_64.tbl
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e"></span><span style="color:#75715e">@@ -391,6 +391,7 @@
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span> 465    common  listxattrat             sys_listxattrat
</span></span><span style="display:flex;"><span> 466    common  removexattrat           sys_removexattrat
</span></span><span style="display:flex;"><span> 467    common  open_tree_attr          sys_open_tree_attr
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">+468    common  room4A                  sys_room4A
</span></span></span></code></pre></div><p>Then, define the number in the generic unistd header:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-diff" data-lang="diff"><span style="display:flex;"><span><span style="color:#f92672">--- a/include/uapi/asm-generic/unistd.h
</span></span></span><span style="display:flex;"><span><span style="color:#f92672"></span><span style="color:#a6e22e">+++ b/include/uapi/asm-generic/unistd.h
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e"></span><span style="color:#75715e">@@ -902,3 +902,5 @@ __SYSCALL(__NR_open_tree_attr, sys_open_tree_attr)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span> #define __NR_lstat64 __NR3264_lstat
</span></span><span style="display:flex;"><span> #endif
</span></span><span style="display:flex;"><span> #endif
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">+
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">+#define __NR_room4A 468
</span></span></span></code></pre></div><h3 class="heading" id="2-hook-up-the-build">
  2. Hook up the build
  <a class="anchor" href="#2-hook-up-the-build">#</a>
</h3>
<p>To make sure our custom C file gets compiled as part of the kernel build process, we need to modify the kernel’s top-level <code>Makefile</code>.</p>
<p>This step connects your code to the build system, without it, the kernel won’t even know your file exists.</p>
<p>We’ll add the actual file in the next step, but for now, let’s tell the kernel to include it.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-diff" data-lang="diff"><span style="display:flex;"><span><span style="color:#f92672">--- a/kernel/Makefile
</span></span></span><span style="display:flex;"><span><span style="color:#f92672"></span><span style="color:#a6e22e">+++ b/kernel/Makefile
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e"></span><span style="color:#75715e">@@ -138,6 +138,7 @@ obj-$(CONFIG_RESOURCE_KUNIT_TEST) += resource_kunit.o
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span> obj-$(CONFIG_SYSCTL_KUNIT_TEST) += sysctl-test.o
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">+obj-$(CONFIG_UTS_NS) += room4A.o
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e"></span>
</span></span><span style="display:flex;"><span> CFLAGS_stackleak.o += $(DISABLE_STACKLEAK_PLUGIN)
</span></span><span style="display:flex;"><span> obj-$(CONFIG_GCC_PLUGIN_STACKLEAK) += stackleak.o
</span></span></code></pre></div><h3 class="heading" id="3-write-the-syscall-implementation">
  3. Write the syscall implementation
  <a class="anchor" href="#3-write-the-syscall-implementation">#</a>
</h3>
<p>Create <code>kernel/room4A.c</code> with the following contents:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;linux/kernel.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;linux/syscalls.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">SYSCALL_DEFINE0</span>(room4A)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">printk</span>(KERN_INFO <span style="color:#e6db74">&#34;Knock knock, room4A. Knock knock, room4A. Knock knock, room4A.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 class="heading" id="building-the-kernel">
  Building the kernel
  <a class="anchor" href="#building-the-kernel">#</a>
</h2>
<p>From the top of your kernel source tree:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Generate a default config and compile</span>
</span></span><span style="display:flex;"><span>make defconfig
</span></span><span style="display:flex;"><span>make -j<span style="color:#66d9ef">$(</span>nproc<span style="color:#66d9ef">)</span>
</span></span></code></pre></div><p>This will compile the kernel using your system’s available CPU cores.</p>
<p>This will produce <code>arch/x86/boot/bzImage</code>, our custom kernel, now including <code>syscall(468)</code>.</p>
<h2 class="heading" id="creating-the-initramfs">
  Creating the initramfs
  <a class="anchor" href="#creating-the-initramfs">#</a>
</h2>
<p>We need a tiny initramfs that invokes our new syscall at startup.</p>
<h3 class="heading" id="1-assemble-the-init-stub">
  1. Assemble the init stub
  <a class="anchor" href="#1-assemble-the-init-stub">#</a>
</h3>
<p>Create init.asm:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nasm" data-lang="nasm"><span style="display:flex;"><span><span style="color:#66d9ef">global</span> _start
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">section</span> .text
</span></span><span style="display:flex;"><span>_start:
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mov</span> rax, <span style="color:#ae81ff">468</span>        <span style="color:#75715e">; syscall number for room4A</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">syscall</span>             <span style="color:#75715e">; invoke the syscall</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">jmp</span> <span style="color:#66d9ef">$</span>               <span style="color:#75715e">; hang forever</span>
</span></span></code></pre></div><p>Build it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nasm -felf64 init.asm -o init.o
</span></span><span style="display:flex;"><span>ld init.o -o init
</span></span></code></pre></div><p>Pack into cpio:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>find . -name init | cpio -o -H newc &gt; init.cpio
</span></span></code></pre></div><p>Now you have init.cpio, the minimal initramfs.</p>
<h2 class="heading" id="running-in-qemu">
  Running in QEMU
  <a class="anchor" href="#running-in-qemu">#</a>
</h2>
<p>Run QEMU to see your syscall in action:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>qemu-system-x86_64 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -kernel arch/x86/boot/bzImage <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -initrd init.cpio <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -nographic <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -append <span style="color:#e6db74">&#34;console=ttyS0&#34;</span>
</span></span></code></pre></div><p>You should see output like:</p>
<pre tabindex="0"><code class="language-less" data-lang="less">...
[    2.736852] x86/mm: Checked W+X mappings: passed, no W+X pages found.
[    2.737495] Run /init as init process
[    2.769848] Knock knock, room4A. Knock knock, room4A. Knock knock, room4A.
[    2.784746] input: ImExPS/2 Generic Explorer Mouse as /devices/platform/i8042/serio1/input/input3
</code></pre><p>That’s it, a brand new syscall that prints &ldquo;Knock knock, room4A. Knock knock, room4A. Knock knock, room4A.&rdquo;</p>


    </main>
  </div>

  
  





    




  <footer>
    

    
    





    




    
    
    
    <p>Created by <a href="https://github.com/JavaHammes">JavaHammes</a></p>
    


  </footer>

  
</body>

<script src="/room4A.dev/js/theme-switch.js"></script>
<script defer src="/room4A.dev/js/copy-code.js"></script>
</html>
